language: bash
branches:
  only:
  - master
env:
  secure: FLDaCcdhSMuMRihAIViVUDN4yHdfMYQV6lIFheAe+ZQWhMNZZUS6Hcl1GfebeyNSy2vP2w5Wene2k2KM5yzriWJ2E4SkMXTIOaNYLOsxb9pJYsivbeVP3jpmsOD/rO2SAw5lSeQYXN0HQbR8ade8J5oiMybb4VFgNyJKKJYLOdw3AXIYDgGfszYHo+KGJS09aPSI+lmYKBoWonHr9c+8DBzUAqY3q8P3gHrxKEIsPHshILb2PS+P2lBCs1pxlXvNslKOt6Jw1YaBHU0vyPkxHvHSBLzoHHe8CG21ly9CNHlt/lTaTjl9B+ettcMVgRsbTLkkNOZAKNFbde1QMz6GM/pyhdZhKtSVgEviie1Qv1XnbaQW5YOQBsLgvr1kDyjx7KGtC6B0KAdolk9eKBsyuZQsZNk7z6XIG7IDIZzIq1yO7ThadWmA6lBr1F3GKcH+jRSxTuIuMP5h0nT9QCISthVbEUx/hizATqQK4PIrOHfyfMe3COZKnbWh2pfWxRU0VcQSdJsA2Tv1mL1LZmuoZHJghfuAFUzaAy6gXHHEtS0msGR9lakFJ/zKKzTFWzXLW/0o+dq2HYZBanLSbmxXvoxc0v7M7MSMxIrfUtEHrqbznyW7cZbUb2oY/JRrTdF/X2sYXSUmPqMp8sLk2ltVpHga4H0zJpJhPKd9fWUiBXg=
services:
- docker
install:
- openssl aes-256-cbc -K $encrypted_e80ce9d13f4b_key -iv $encrypted_e80ce9d13f4b_iv
  -in snap/.snapcraft/travis_snapcraft.cfg -out snap/.snapcraft/snapcraft.cfg -d
- locale-gen en_US.UTF-8
- cat version
- PARSEC_VERSION=`cat version | cut -c -32`
- cd snap
- sed -i '2d' snapcraft.yaml
- sed -i "2iversion:\ $PARSEC_VERSION" snapcraft.yaml
- cd ..
script: |-
  docker run -v $(pwd):$(pwd) --rm -t snapcore/snapcraft:stable sh -c "
    apt update -qq &&
    apt-get install -y software-properties-common &&
    add-apt-repository -y ppa:deadsnakes/ppa &&
    apt update -qq &&
    cd $(pwd)/snap &&
    snapcraft
  "
before_deploy:
- export TRAVIS_TAG=$PARSEC_VERSION
deploy:
  - provider: releases
    file: snap/parsec_*.snap
    file_glob: true
    api_key:
      secure: Q6gmlwEr9Rj/2Ir5OqA6bhCKMjJCNcr+not8q83ephTWyGPTgebhV8yrl00utlfuLuafK88UcWWpmuCzDKcI8rjfiOXVQzMSoqVtJjr/Dcgge7mha3Ec3IzRpAwrg73KwuUhrV/W5Efu1nHaBGA4WYLrd4sFboscdTrFnaJq4wgTVM1qP9vLRXRzuHlM/Hrt/gj9e99DqB0n3DWT9T4ew9haFhY/nn8cyLztU4FwjqZXCqpSqAj3MviFe6AIYg97Xmhilm/4H4JJFGkcBnGhajqoGd0vXKo9Bg8EnmlDMGgCmKw9s2fk0sa5w4umKApLxhdKuejhjXpEodQxJXuRbp2v4bCoreSeIuks7U5kAADxUZoeZznKopYMbgMTkD/20ZKAoCuRHqsJMivDif9g8I3wD63Dik+bXnNtI3GN6DgCr4H3okMC4tjr9BQ7mLY1kR9OxnETRRjGX87Th61XvPWtPOxDcGZ/9MKGBWcRfohvlzhR2+asfJuvza7rof9k4WcBR6oi5Y70ZC74lUJP5EQFgxblbOhboXm36DnC95x7+x8rDK5dcivJFiGFyO2P3uIVdKjgVZxgTt29L4+vZoSWN0AekNPvVNUMlyCnCkGNQj6GOrWpE4zMINvt6Z4qromkukZv13WHRPZQ4h6sDWUWd5pSXbBn2ZRnUHBWj3E=
    skip_cleanup: true
  - provider: script
    script: bash deploy_snap.sh
    skip_cleanup: true
